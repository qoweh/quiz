<!-- templates/quiz/results.html - 퀴즈 결과 페이지 -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>퀴즈 결과</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .correct-answer {
      background-color: #d4edda;
      border-left: 5px solid #28a745;
    }
    .incorrect-answer {
      background-color: #f8d7da;
      border-left: 5px solid #dc3545;
    }
    .option-correct { color: #28a745; font-weight: bold; }
    .option-incorrect { color: #dc3545; }
    .my-answer {
      background-color: #fff3cd;
      padding: 8px;
      border-radius: 4px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div class="container mt-4">
  <h2 class="text-center mb-4">퀴즈 결과</h2>

  <!-- 알림 메시지 -->
  <div th:if="${success}" class="alert alert-success text-center" th:text="${success}"></div>
  <div th:if="${error}" class="alert alert-danger text-center" th:text="${error}"></div>

  <!-- 결과가 없는 경우 -->
  <div th:if="${noResults}" class="text-center">
    <div class="alert alert-warning">
      <h4>풀이 결과가 없습니다.</h4>
      <p>먼저 퀴즈를 풀어주세요.</p>
      <a href="/quiz/questions" class="btn btn-primary">퀴즈 풀러 가기</a>
    </div>
  </div>

  <!-- 결과 통계 -->
  <div th:unless="${noResults}" class="row mb-4">
    <div class="col-md-12">
      <div class="card">
        <div class="card-body text-center">
          <h4>점수: [[${correctCount}]] / [[${totalCount}]]</h4>
          <h5 class="text-muted">정답률: [[${accuracy}]]%</h5>
          <div class="progress mt-3" style="height: 20px;">
            <div class="progress-bar bg-success" role="progressbar"
                 th:style="'width: ' + ${accuracy} + '%'">
              [[${accuracy}]]%
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 문제별 상세 결과 -->
  <div th:unless="${noResults}">
    <div th:each="result, iterStat : ${results}"
         class="card mb-4"
         th:classappend="${result.correct} ? 'correct-answer' : 'incorrect-answer'">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">문제 [[${iterStat.count}]]</h5>
        <span th:if="${result.correct}" class="badge bg-success">정답</span>
        <span th:unless="${result.correct}" class="badge bg-danger">오답</span>
      </div>
      <div class="card-body">
        <p class="card-text lead" th:text="${result.question}"></p>

        <!-- 선택지들 -->
        <div class="mt-3">
          <div th:each="option, optionStat : ${result.options}" class="mb-2">
                            <span th:class="${optionStat.count == result.rightAnswer} ? 'option-correct' : ''">
                                [[${optionStat.count}]]. [[${option}]]
                                <span th:if="${optionStat.count == result.rightAnswer}">✓ (정답)</span>
                            </span>
          </div>
        </div>

        <!-- 해설 -->
        <div class="mt-3 p-3 bg-light rounded">
          <strong>해설:</strong>
          <p class="mt-2 mb-0" th:text="${result.explanation}"></p>
        </div>

        <!-- 내가 선택한 답 (틀린 경우만) -->
        <div th:unless="${result.correct}" class="my-answer mt-3">
          <strong>내가 선택한 답:</strong>
          <span class="option-incorrect">[[${result.myAnswer}]]번</span>
        </div>

        <small class="text-muted d-block mt-2">
          난이도: [[${result.difficultyLevel}]]
        </small>
      </div>
    </div>

    <!-- 하단 버튼들 -->
    <div class="text-center mb-5">
      <form th:action="@{/quiz/reset}" method="post" class="d-inline">
        <button type="submit" class="btn btn-warning me-3"
                onclick="return confirm('정말 리셋하시겠습니까?')">
          다시 풀기
        </button>
      </form>
      <a href="/quiz" class="btn btn-primary me-3">새 퀴즈 생성</a>
      <a href="/quiz/questions" class="btn btn-outline-secondary">현재 퀴즈 다시 보기</a>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>